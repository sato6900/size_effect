# 暗号資産市場における「サイズ効果」検証プラン

## 1. 検証の目的

暗号資産市場において、銘柄の「出来高規模（サイズ）」によってテクニカル指標（21日リターン）の有効性がどのように変化するかを検証する。特に、以下の動画内の仮説を再現する。

* **大型銘柄**: モメンタム（順張り）が効きやすい、あるいは傾向が不明瞭。
* **小型銘柄**: 強いリバーサル（逆張り）特性が見られる。

## 2. 実装環境

* **エディタ**: Cursor (Claude 3.5 Sonnet 推奨)
* **使用言語**: Python (Jupyter Notebook)
* **主要ライブラリ**: `pandas`, `numpy`, `matplotlib`, `ccxt`

## 3. 検証プロセス

### ステップ1：データ収集とフィルタリング

* **対象**: Binance無期限先物（Perpetual）の上場銘柄。
* **期間**: 2023年1月1日 〜 現在。
* **前処理**:
* 欠損値の多い銘柄（新規上場直後など）を除外。
* 全期間の平均的な流動性を担保するため、平均日次出来高が一定以上（例：1M USD以上）の銘柄を抽出。



### ステップ2：サイズ（出来高）によるグループ分け

銘柄を日次出来高（USDベース）に基づき、以下の3つのグループに分類する。

1. **Large (大型)**: 出来高上位33%
2. **Middle (中型)**: 中位33%
3. **Small (小型)**: 下位33%
※ 出来高は「検証時点の直近平均」または「ローリング平均」で算出。

### ステップ3：テクニカル指標の算出と5分位分類

各銘柄について、以下の計算を行う。

1. **シグナル**: 過去21日間の累積リターン。
2. **データリーク対策**: 当日のリターンを含まないよう、シグナルを**1日シフト (`.shift(1)`)** する。
3. **クオンタイル化**: 各グループ（Large/Mid/Small）内で、シグナルの大きさに応じて銘柄を5つのクオンタイル（Q1:最低 〜 Q5:最高）に分ける。

### ステップ4：パフォーマンスの集計と可視化

各サイズグループにおいて、以下の指標をプロット・比較する。

* **翌日平均リターン**: Q1〜Q5の各グループが翌日に平均何%動いたか（ヒストグラム）。
* **スプレッドリターン**:
* 小型株の場合: `Q1(下落銘柄) - Q5(上昇銘柄)` の累積リターン（リバーサル検証）。
* 大型株の場合: `Q5(上昇銘柄) - Q1(下落銘柄)` の累積リターン（モメンタム検証）。



## 4. Cursorへの指示用プロンプト案

Cursorのチャット（Ctrl+L）に以下を貼り付けて実装を開始してください。

```text
暗号資産の「サイズ効果」を検証するJupyter Notebookを作成してください。
以下の手順で実装をお願いします。

1. CCXTを使用してBinance先物の日足データを2023年から取得してください。
2. 銘柄を平均出来高に基づき、Large, Mid, Smallの3つのグループに分割してください。
3. 各銘柄の過去21日リターンを計算し、1日シフトしてシグナルとします（リーク防止）。
4. サイズグループごとに、シグナルの強弱による5分位（Q1-Q5）の翌日リターンを算出してください。
5. 「小型銘柄のリバーサル（Q1-Q5）」と「大型銘柄のモメンタム（Q5-Q1）」の累積リターンを比較するグラフを描画してください。

```

## 5. 期待される結果の解釈

* **小型銘柄のグラフが右肩上がり**: 「大きく上がった小型株は売られ、下がった株は買い戻される」というリバーサル特性の証明。
* **大型銘柄のグラフが右肩上がり（または横ばい）**: 「大型株はトレンドが継続しやすい」あるいは「テクニカルが効きにくい」という特性の確認。